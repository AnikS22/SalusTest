\documentclass[tikz,border=10pt]{standalone}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,calc,decorations.pathreplacing}
\usepackage{amsmath}

\begin{document}

\begin{tikzpicture}[
    timestep/.style={rectangle, draw, fill=blue!20, minimum width=0.8cm, minimum height=2cm},
    window/.style={rectangle, draw, fill=green!20, thick, minimum width=8.5cm, minimum height=2.5cm},
    prediction/.style={circle, draw, fill=red!30, minimum size=1cm, font=\small},
    arrow/.style={thick,->,>=stealth}
]

% Title
\node[font=\Large\bfseries] at (5, 7) {Multi-Horizon Temporal Forecasting};

% Time axis
\draw[->,thick] (-1, 5) -- (14, 5) node[right] {Time};

% Historical timesteps (grayed out)
\foreach \x in {0, 1, 2} {
    \node[timestep, fill=gray!30] (t\x) at (\x, 5) {};
    \node[below, font=\tiny] at (\x, 3.8) {$t-\x$};
}

% Sliding window (10 timesteps)
\node[window] (window) at (5.5, 5) {};
\node[above, font=\bfseries, color=green!60!black] at (5.5, 6.3) {333ms Sliding Window (10 timesteps @ 30Hz)};

% Current window timesteps
\foreach \x in {3, 4, 5, 6, 7, 8, 9, 10, 11, 12} {
    \node[timestep] (t\x) at (\x, 5) {};
    \node[below, font=\tiny] at (\x, 3.8) {$t{-}\pgfmathparse{int(12-\x)}\pgfmathresult$};
}

% Current timestep (highlighted)
\node[timestep, fill=orange!60] (tcurrent) at (12, 5) {};
\node[below, font=\small\bfseries, color=orange!60!black] at (12, 3.6) {$t$ (now)};

% Signal vectors
\foreach \x in {3, 4, 5, 6, 7, 8, 9, 10, 11, 12} {
    \node[font=\tiny] at (\x, 5.5) {$\mathbf{z}_{\pgfmathparse{int(\x-12)}\pgfmathresult}$};
}

% Matrix notation
\node[font=\small, align=center] at (5.5, 4) {
    $\mathbf{Z}_t = [\mathbf{z}_{t-9}, \mathbf{z}_{t-8}, \ldots, \mathbf{z}_t]$\\
    $\in \mathbb{R}^{10 \times 12}$
};

% Predictor
\node[draw, fill=purple!30, rounded corners, text width=3.5cm, text centered, minimum height=1.5cm] (predictor) at (5.5, 1.5) {
    \textbf{Hybrid Predictor}\\
    Conv1D + GRU\\
    (31K parameters)
};

\draw[arrow, very thick, green!60!black] (window) -- (predictor);

% Multi-horizon predictions
\node[prediction, fill=red!20] (h1) at (13.5, 4.5) {200ms};
\node[prediction, fill=red!40] (h2) at (14.5, 4.5) {300ms};
\node[prediction, fill=red!60] (h3) at (15.5, 4.5) {400ms};
\node[prediction, fill=red!80] (h4) at (16.5, 4.5) {500ms};

\draw[arrow, very thick, red!60!black] (predictor) -- (14.5, 3);

% Future timeline
\draw[dashed, gray, thick] (13, 5) -- (17, 5);
\node[below, font=\tiny, color=gray] at (13, 4.8) {Future};

% Horizon markers
\draw[dashed, red!40] (13.5, 5) -- (13.5, 4.5);
\draw[dashed, red!50] (14.5, 5) -- (14.5, 4.5);
\draw[dashed, red!60] (15.5, 5) -- (15.5, 4.5);
\draw[dashed, red!70] (16.5, 5) -- (16.5, 4.5);

% Failure type predictions per horizon
\node[draw, fill=yellow!20, text width=5.5cm, align=left, font=\small] at (15, 1.5) {
    \textbf{Per-horizon predictions:}\\
    $\hat{\mathbf{y}}_t^h = [p_{\text{collision}}, p_{\text{drop}}, p_{\text{miss}}, p_{\text{timeout}}]$\\
    \\
    Total: $\hat{\mathbf{y}}_t \in \mathbb{R}^{16}$ (4 horizons $\times$ 4 types)
};

% Time annotations
\draw[decorate, decoration={brace, amplitude=5pt, mirror}] (3, 3.4) -- (12, 3.4);
\node[below, font=\small] at (7.5, 3.1) {10 timesteps = 333ms};

\draw[decorate, decoration={brace, amplitude=5pt}] (13.5, 5.3) -- (16.5, 5.3);
\node[above, font=\small] at (15, 5.6) {200-500ms forecasting};

% Legend
\node[draw, fill=white, text width=8cm, font=\footnotesize, align=left, anchor=north west] at (-1, 0.5) {
    \textbf{Temporal Context:} Model sees 333ms history to detect drift patterns\\
    \textbf{Multi-Horizon:} Predictions at 4 time scales enable adaptive intervention\\
    \textbf{Efficiency:} Single predictor forward pass for all horizons
};

\end{tikzpicture}

\end{document}
